<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="Tic Tac Toe game">
  <meta name="author" content="Kevin Nolan">

  <link href="https://fonts.googleapis.com/css?family=Catamaran" rel="stylesheet">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <title>Tic Tac Toe</title>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Catamaran', sans-serif;
    }
    .board-cell {
      border:5px solid green;
      background-color:#55ffff;
      min-height: 100px;
      color: white;
      font-size: 4em;
      text-align: center;
    }
    
  </style>
</head>
<body>
<div class="container">
  <h1>Tic Tac Toe</h1>

  <div class="row">
    <div class="col-xs-4 board-cell" id="00" onclick="playerAct(0,0)"></div>
    <div class="col-xs-4 board-cell" id="01" onclick="playerAct(0,1)"></div>
    <div class="col-xs-4 board-cell" id="02" onclick="playerAct(0,2)"></div>
  </div>
  <div class="row">
    <div class="col-xs-4 board-cell" id="10" onclick="playerAct(1,0)"></div>
    <div class="col-xs-4 board-cell" id="11" onclick="playerAct(1,1)"></div>
    <div class="col-xs-4 board-cell" id="12" onclick="playerAct(1,2)"></div>
  </div>
  <div class="row">
    <div class="col-xs-4 board-cell" id="20" onclick="playerAct(2,0)"></div>
    <div class="col-xs-4 board-cell" id="21" onclick="playerAct(2,1)"></div>
    <div class="col-xs-4 board-cell" id="22" onclick="playerAct(2,2)"></div>
  </div>
</div>
<!--For proper squaring of the board: http://stackoverflow.com/questions/26084770/bootstrap-css-how-to-set-a-divs-height-according-to-its-width-->
<script>
// Play tic-tac-toe against the computer
// Game resets on win/lose so you can replay
// Player can be O or X
// Bonus: difficulty levels from easy to unbeatable
// Bonus: computer turn isn't instant

const bCells = [[],[],[]]; // Where references to the board cells are
const board = [ ['c','c','c'],
                ['c','c','c'],
                ['c','c','c'] ]; // c=clear (neither x or o)
let pMark = 'o'; // player's marker
let cMark = 'x';
let turn='p';     // p=player, c=computer
const s = { // Regular expressions for scanning the board
  xWin: /xxx/,
  oWin: /ooo/,
  clrCell: /c/,
  xCell: /x/,
  oCell: /o/
}

//board [0][2]='o'; board[1][1]='x'; board[2][0]='x';
getBoardCells();

function playerAct(row,col) {
  // Check space tapped on is clear and it's player's turn
  if (board[row][col] =='c' && turn == 'p') {
    markBoard(pMark,row,col)
    winCheck();
  }
}

function computerAct() {
  /*
Always win or draw rules: assumes you play x. In order of priority.

1- If you have 2 x's lined up and a free space, put down an x (and win the game).
3- If your opponent has 2 o's lined up and a free space, put down an x (and block them from winning).

5- If board is empty pick a random corner
5- If only marker in play is opponent's o and it's in a corner, put X in the center (you must do this to not lose)
5- If only marker in play is opponent's o and it's in the center, put X into a random corner (this will force a draw unless your opponent makes a mistake and lets you get 3 in a row)

5- If you have an x in a corner, there's an o in the center and no other counters present, put an x in the opposite corner.
U- If you have an x in two corners and neither is blocked, put an X in another corner (and you will then be unbeatable). This is unnecessary as by this point of play the opponent will always have two markers lined up that you must defend against.
5- If you have an X in a corner, there's one o in play but not in the center, put the X into a random other free corner as long as there's an empty space between them (at this point you will always win)

7-If you have an X in play and two free spaces, put down an X so as to win with the third X.
  */

  // check if 2 comp marks and a free space are lined up (to win the game)
  // check if 2 player marks and a free space are lined up (to block player win)

  // Pick random clear cell
  let scArr = scanBoard(s.clrCell);
  let r = Math.floor(Math.random())*scArr.length;
  markBoard(cMark,scArr[r][0],scArr[r][1]);

  //markBoard(cMark,0,2);
  winCheck();
}


function markBoard(mark,row,col) {
  board[row][col]=mark;
  bCells[row][col].innerHTML=mark;
}

function getBoardCells() {
  for (let i = 0; i < 3; i++) {
    for (let j = 0; j < 3; j++) {
      bCells[i][j] = document.getElementById(''+i+j);
    }
  }
}

function winCheck() {
  let xScan = scanLines(s.xWin);
  let oScan = scanLines(s.oWin);
  let clScan = scanBoard(s.clrCell);
  if (xScan) winner('x',xScan);
  else if (oScan) winner('o',oScan);
  else if (!clScan) console.log("We have a draw.");
  else if (turn == 'p') {
    turn = 'c';
    computerAct();
  } else {
    turn = 'p';
  }
}

function winner(side,winArr) {
  winArr.map(function(val,ind) {
    let cell = winArr[ind];
    bCells[cell[0]][cell[1]].style.backgroundColor="blue";
  });
  console.log(side + " wins!")
}

// Returns the cells in the first row line that matches the regExp, or null
function scanLines(rE) { 
  //Horizontal
  for (i=0; i < 3; i++) {
    let scan = board[i].reduce(function(acc,val) {
      return acc + val;
    },"");
    if (rE.test(scan)) return [[i,0],[i,1],[i,2]]; 
  }
  // Vertical
  for (i=0; i < 3; i++) {
    scan = board[0][i] + board[1][i] + board[2][i];
    if (rE.test(scan)) return [[0,i],[1,i],[2,i]];
  }
  // Diagonal
  scan = board[0][0] + board[1][1] + board[2][2];
  if (rE.test(scan)) return [[0,0],[1,1],[2,2]];
  scan = board[2][0] + board[1][1] + board[0][2];
  if (rE.test(scan)) return [[2,0],[1,1],[0,2]];
  return null;
}

// Returns all the cells that match the regExp, or null. Only checks single cells.
function scanBoard(rE) {
  let resArr=[];
  board.map (function(val,i) {
    val.map (function(vl,j) {
      if (rE.test(vl)) resArr.push([i,j]);
    });
  });
  return (resArr.length == 0) ? null : resArr;
}

</script>


</body>

